# פונקציות

עד עכשיו יצא לנו להכיר פונקציות רבות ב
base-r.
בנוסף לפונקציות שהשתמשנו בהם, שאנשים אחרים תכנתו עבורונו, אנחנו יכולים לתכנת בעצמנו פונקציות שיעשו איזה משימה שנטיל עליהן!

## למה לכתוב פונקציות?

אם אנחנו מוצאים את עצמנו עושים את אותה הפעולה באופן חזרתי שוב ושוב, אנחנו סתם מבזבזים זמן בהקלדה מיותרת ומייגעת. בנוסף, הקוד החזרתי מקשה על הקריאה של הסקריפט שלנו. שימוש בפונקציות, שאותן נגדיר בראש הסקריפט שלנו, או בסקריפט אחר, יהפכו את הקוד שלנו ל״נקי״ ו״קריא״ יותר.

## מגניב, איך עושים את זה?

המבנה של כתיבת פונקציה נראה כך:

```{r eval=FALSE, include=TRUE}
name_of_my_function <- function(input_1, ..., input_n){
  code
  .
  .
  .
  code
  return(my_output)
}
```

כלומר,
אנחנו מגדירים פונקציה בשם שאנחנו בוחרים, וקובעים שמות למשתנים שהפונקציה תקבל.
לאחר מכן, בתוך הסוגריים המעוגלים, נעשה פעולות על הקלטים של הפונקציה,
ונבסוף, נחזיר את מה שנרצה בתוך הפקודה
`return`


## כמה דוגמאות

### דוגמא ראשונה - פונקציה שמקבלת משוואה רבועית, ומחזירה את שורשיה

משוואה ריבועית היא משוואה מהצורה הזאת

$$
f(x) = a \cdot x^2 + b \cdot x + c
$$


שורשים של משוואה כזאת מוגדרים להיות ערכי ה
$x$
אשר עבורם המשוואה שווה ל
$0$
.

יש למשוואה רבועית נוסחא סגורה ומפורסת, שאני מניח שרובנו נתקלנו בה אי-אז בימי בית הספר העליזים.

$$
x_{1,2} = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}
$$
כאשר 
$a, b, c$
הם מקדמי המשוואה כפי שהגדרנו.

אנחנו נכתוב עכשיו פונקציה פשוטה יחסית ב 
R
שעבור כל משוואה ריבועית, תגיש לנו על מגש של כסף את פתרונותיה.
התשובה תתקבל במהירות, והתוכנה תמיד תחזיר לנו תשובה נכונה, איזה כי, זה לתכנת, אה?

אחלה. נתחיל. נקרא לפונציה שלנו 
sqrt_res,
היא תקבל שלושה ערכים, שכולם יהיו מספרים,
$a, b, c$
אשר יתארו במדוייק את המשוואה הריבועית שעבורה אנחנו מעוניינים למצוא שורשים.
הפלט שלה יהיה וקטור באורך 2.
למשוואה רבועית יכולים להיות לכל היותר 2 פתרונות ממשיים, אך יישנן משוואות רבועיות שיש להן פתרון יחיד, או אפס פתרונות.
במקרה הזה, הפונקציה שלנו תחזיר בוקטור ערכים חסרים


```{r}
sqrt_res <- function(a, b, c){
  
  if((b**2 - 4*a*c) == 0){
    return(c(-b/(2*a), NA))
  } else if((b**2 - 4*a*c) < 0){
    return(c(NA, NA))
  } else{
    x_1 <- (-b + (b**2 + 4*a*c)**0.5)/(2*a)
    x_2 <- (-b - (b**2 + 4*a*c)**0.5)/(2*a)
    return(c(x_1, x_2))
  }
}
```

בואו נעשה שימוש בפונקציה שלנו!

$$
f(x) = x^2
$$

```{r}
sqrt_res(a = 1, b = 0, c = 0)
```

$$
f(x) = x^2 + 3
$$

```{r}
sqrt_res(a = 1, b = 0, c = 3)
```



$$
f(x) = 2x^2 + 3x + 1
$$

```{r}
sqrt_res(a = 2, b = 3, c = 1)
```


מגניב.
יש לשים לב שאם הפונקציה שלנו היתה מקבלת קלטים לא רצויים, נניח מחרוזות במקום מספרים היא היתה ״נשברת״, כלומר לא עובדת כמו שרצינו שהיא תעבוד. ניתן להפוך את הפונקציה שלנו ל״חסינה״ לקלטים לא רצויים כך:


```{r}
sqrt_res <- function(a, b, c){
  if(class(c(a,b,c)) != "numeric"){
    return("bad inputs!!!")
  }
  
  if((b**2 - 4*a*c) == 0){
    return(c(-b/(2*a), NA))
  } else if((b**2 - 4*a*c) < 0){
    return(c(NA, NA))
  } else{
    x_1 <- (-b + (b**2 + 4*a*c)**0.5)/(2*a)
    x_2 <- (-b - (b**2 + 4*a*c)**0.5)/(2*a)
    return(c(x_1, x_2))
  }
}
```


נמשיך לדוגמא הבאה.

### דומגא שניה - שיטה נומרית לחישוב נגזרת

נגדרת של פונקציה מוגדרת להיות הגבול הבא:

$$
f'(x) = \lim_{x_0 \to x}{\frac{f(x) - f(x_0)}{x-x_0}}
$$
המשמעות של הגבול הזה היא כמה שינוי קטן מאוד בערך ה 
x
משפיע על ערך ה
y
של הפונקציה.

משוואה שקולה לחלוטין לחישוב הנגדרת היא

$$
f'(x) = \lim_{h \to 0}{\frac{f(x) - f(x + h)}{h}}
$$

נוכל לחשב קירוב של הביטוי הזה בלי לחשב את הגבול. נקבע ערך ל
`h`
שיהיה מספר מאוד קטן, ונציב אותו במשוואת הגבול. אומנם לא נקבל תוצאה מדוייקת לחלוטין, ויש מקרים, כמו עבור פונקציות שערך הגבול הזה אינו מוגדר עבורן, שנקבל תוצאה שוגיה לחלוטין - בדרך כלל הקירוב שנקבל בשיטה הזאת, עבור פונקציות טריוואליות, יהיה מצויין.

בדוגמא הזאת אני רוצה לעשות שימוש בפונקציה אנונימית עבור
$f(x)$. 
ניתן ליצור פונקציה ללא שתשמש אותנו. למשל פונקציה אנונימית שמקבלת מספר ומחזירה על הערך המוחלט שלו בריבוע

```{r}
function(x){(abs(x)^2)}
```

נוכל לעשות שימוש בפונקציה עבור חישוב הנגזרת הנומרי שלנו

```{r}
derivative <- function(f, x){
  epssilon <- 0.000001
  return((f(x + epssilon) - f(x)) / epssilon)
}
```

בואו נשחק קצת עם הפונקציה החדשה שלנו!

מה הערך של 
$f'(3.14)$
של 

$$
f(x) = x^{2.71} - x + e^x
$$

```{r}
derivative(function(x){x^2.71 - x + exp(x)}, 3.14)
```

קל. מוזמנים לבדוק על ידי גזירה ידנית.










